---
const integrationOptions = [
  'E-commerce Platform',
  'CRM System',
  'Help Desk Software',
  'Marketing Automation',
  'Custom Integration'
];
---
<section id="request-demo" class="py-16 px-4 bg-gray-50">
  <div class="max-w-3xl mx-auto">
    <h2 class="text-3xl font-bold text-center mb-8">Request a Demo</h2>
    <form id="demo-form" class="space-y-6 bg-white p-8 rounded-xl shadow-sm">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
          <input
            type="text"
            id="name"
            name="name"
            required
            class="w-full px-4 py-2 rounded-lg border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary"
          />
        </div>
        <div>
          <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
          <input
            type="email"
            id="email"
            name="email"
            required
            class="w-full px-4 py-2 rounded-lg border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary"
          />
        </div>
        <div>
          <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
          <input
            type="tel"
            id="phone"
            name="phone"
            required
            class="w-full px-4 py-2 rounded-lg border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary"
          />
        </div>
        <div>
          <label for="business" class="block text-sm font-medium text-gray-700 mb-1">Business Name</label>
          <input
            type="text"
            id="business"
            name="business"
            required
            class="w-full px-4 py-2 rounded-lg border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary"
          />
        </div>
        <div>
          <label for="integration" class="block text-sm font-medium text-gray-700 mb-1">Integration Type</label>
          <select
            id="integration"
            name="integration"
            required
            class="w-full px-4 py-2 rounded-lg border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary"
          >
            <option value="">Select Integration Type</option>
            {integrationOptions.map(option => (
              <option value={option}>{option}</option>
            ))}
          </select>
        </div>
        <div>
          <label for="demo_date" class="block text-sm font-medium text-gray-700 mb-1">Preferred Demo Date</label>
          <input
            type="date"
            id="demo_date"
            name="demo_date"
            required
            min={new Date().toISOString().split('T')[0]}
            class="w-full px-4 py-2 rounded-lg border-gray-300 focus:ring-2 focus:ring-primary focus:border-primary"
          />
        </div>
      </div>
      <div class="text-center">
        <button
          type="submit"
          class="bg-primary text-white px-8 py-3 rounded-lg hover:bg-indigo-600 transition-colors"
        >
          Schedule Demo
        </button>
      </div>
    </form>
  </div>
</section>

<script>
const demoForm = document.getElementById('demo-form');

demoForm?.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const formData = new FormData(e.target as HTMLFormElement);
  
  try {
    const response = await fetch('http://localhost:3000/api/v1/accounts/1/contacts', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'api_access_token': 'D92TzUoFsTeTWy8MvtxVcwb1'
      },
      body: JSON.stringify({
        name: formData.get('name'),
        inbox_id: 1,
        phone_number: formData.get('phone'),
        email: formData.get('email'),
        custom_attributes: {
          Business_name: formData.get('business'),
          Date: formData.get('demo_date')
        }
      })
    });

    if (response.ok) {
      alert('Thank you! We will contact you shortly to schedule your demo.');
      (e.target as HTMLFormElement).reset();
    } else {
      throw new Error('Failed to submit form');
    }
  } catch (error) {
    console.error('Error:', error);
    alert('Sorry, there was an error submitting your request. Please try again later.');
  }
});
</script>